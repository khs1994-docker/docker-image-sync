on:
  push:
  workflow_dispatch:

name: ci

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - run: |
          docker manifest inspect moby/buildkit
      - run: |
          docker manifest inspect moby/buildkit@sha256:e39f6119f134b4811af19fd5c20f495a6a264a85c1b6920daf569b23009dd42c
      - run: |
          docker run -i --rm \
            -e SOURCE_DOCKER_USERNAME=${DOCKER_USERNAME} \
            -e SOURCE_DOCKER_PASSWORD=${DOCKERIO_PASSWORD} \
            -e DEST_DOCKER_USERNAME=${DOCKER_USERNAME} \
            -e DEST_DOCKER_PASSWORD=${DOCKER_PASSWORD} \
            -e DEST_DOCKER_REGISTRY=ghcr.io \
            -e DEST_NAMESPACE=dpsigs \
            -e CI=true \
            -e GITHUB_ACTIONS \
            -e LNMP_CN_ENV=false \
            -e CONFIG_URL=https://github.com/khs1994-docker/docker-image-sync/raw/master/docker-image-sync-ghcr.json \
            ghcr.io/khs1994/docker-image-sync
        env:
          DOCKER_USERNAME: khs1994
          DOCKER_PASSWORD: ${{secrets.GHCR_IO_TOKEN}}
          DOCKERIO_PASSWORD: ${{secrets.DOCKER_PASSWORD}}
        name: Sync docker image
